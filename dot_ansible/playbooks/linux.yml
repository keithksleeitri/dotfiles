---
# Linux playbook - Ubuntu/Debian setup
- name: Linux setup
  hosts: local
  gather_facts: true

  pre_tasks:
    - name: Wait for apt lock to be released
      become: true
      tags: [sudo, base, zsh, neovim, devtools, docker, nerdfonts]
      ansible.builtin.shell: |
        while fuser /var/lib/dpkg/lock-frontend >/dev/null 2>&1; do
          echo "Waiting for apt lock (held by another process)..."
          sleep 5
        done
      args:
        executable: /bin/bash
      changed_when: false
      register: apt_lock_wait
      timeout: 300

  roles:
    - role: base
      tags: [base]

    - role: zsh
      tags: [zsh]

    - role: starship
      tags: [starship]

    - role: neovim
      tags: [neovim]

    - role: lazyvim_deps
      tags: [lazyvim_deps]

    - role: devtools
      tags: [devtools]

    - role: docker
      tags: [docker]

    - role: nerdfonts
      tags: [nerdfonts]

    - role: coding_agents
      tags: [coding_agents]

    - role: bitwarden
      tags: [bitwarden]

    - role: security_tools
      tags: [security_tools]

    - role: python_uv_tools
      tags: [python_uv_tools]

    - role: rust_cargo_tools
      tags: [rust_cargo_tools]

    - role: ruby_gem_tools
      tags: [ruby_gem_tools]
