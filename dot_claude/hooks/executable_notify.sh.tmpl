#!/usr/bin/env bash
set -euo pipefail

# Claude Code notification hook using apprise
# Notifications are configured in ~/.config/apprise/apprise.yaml

# Read JSON from stdin
json="$(cat)"

# Parse fields
event="$(echo "$json" | jq -r '.hook_event_name // "unknown"')"
title="$(echo "$json" | jq -r '.title // "Claude Code"')"
msg="$(echo "$json" | jq -r '.message // empty')"
ntype="$(echo "$json" | jq -r '.notification_type // empty')"

# Handle Stop event (no message/title in payload)
if [[ "$event" == "Stop" ]]; then
  title="Claude Code"
  msg="Task finished"
fi

# Build full title with notification type
full_title="$title"
[[ -n "$ntype" ]] && full_title="$title [$ntype]"

# Send notification via apprise using desktop tag
# Desktop notifications are auto-detected by OS in apprise.yaml
apprise --tag desktop --title "$full_title" --body "$msg" 2>/dev/null || true
